import{_ as Se,r as i,p as _e,u as Ee,q as Pe,t as be,v as Ce,c as $,o as Te,x as Ie,S as G,w as ee,d as f,e as Ne,f as _,g as q,j as d,k as P,i as p,m as te,y as w,F as Ae,z as b,A as Le,B as z,C as ke,D as ae,T as O,E as j,I as Oe,G as C}from"./index-ef324455.js";const je=b(()=>C(()=>import("./GeneralData-99dec573.js"),["assets/GeneralData-99dec573.js","assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Fe=b(()=>C(()=>import("./index-ef324455.js").then(m=>m.a1),["assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Re=b(()=>C(()=>import("./index-ef324455.js").then(m=>m.$),["assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Ve=b(()=>C(()=>import("./index-ef324455.js").then(m=>m.a0),["assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Me=b(()=>C(()=>import("./index-ef324455.js").then(m=>m.$),["assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Be=b(()=>C(()=>import("./index-ef324455.js").then(m=>m.a0),["assets/index-ef324455.js","assets/index-ebfc87d1.css"])),Ge={components:{GeneralData:je,GeneralDataNOI:Fe,PreAdmissionDataNew:Re,ExternalCauses:Ve,preAdmissionDataNew:Me,externalCauses:Be},setup(){const m=i(!1),r=i([]),N=i([]),a=_e(),g=i(new Date(new Date().setDate(new Date().getDate()-7))),y=i(new Date),c=Ee(),F=Pe(),D=be(),T=Ce(F,c.details),h=i(null),R=i([]),V=i({}),A=i(!1),M=i(!1),L=i(!1),k=i(!1),x=i(null),l=i(!1),B=i(!1),W=i(!1),J=i(!1),U=i(!1),H=i(!1),K=i([]),oe=i(),se=i(),ne=$(()=>r.value.length===0),S=i(!1),Q=new Oe;Le("v$",T);const re=$(()=>g.value!=null&&y.value!=null),E=e=>{if(!e)return"";const o=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}/${o}/${n}`};oe.value=E(g.value),se.value=E(y.value);const ie=i({global:{value:null,matchMode:z.CONTAINS},status:{value:null,matchMode:z.IN},date:{value:null,matchMode:z.EQUALS}}),Y=async()=>{S.value=!0;const e=t=>new Promise(n=>setTimeout(n,t)),o=ke().value;try{const t=[],n=[];for(const s of r.value)s.status="2",s.header.status="2",n.push(s.enccode),t.push({enccode:s.enccode,patname:`${s.header.patlast}, ${s.header.patfirst} ${s.header.patmiddle}`,patsex:s.header.patsex,patage:s.header.patage,injrem:s.header.injrem,injtme:s.header.injtime,injloc:s.header.injloc});await Q.sendArrayToServer(t,o),await e(1e3)}catch(t){console.error("Error exporting data to Excel:",t),D.add({severity:"error",summary:"Export Error",detail:"Failed to export data to Excel",life:3e3})}finally{S.value=!1}},le=()=>{if(localStorage.getItem("patientStore")){const e=JSON.parse(localStorage.getItem("enccode")),o=JSON.parse(localStorage.getItem("status")),t=JSON.parse(localStorage.getItem("header")),n=JSON.parse(localStorage.getItem("data"));c.enccode=e,c.status=o,c.header={...t},c.details={...n},c.loadPatientData()}},de=async e=>{const o=x.value[e];o.status=c.status;const t=JSON.parse(localStorage.getItem("indices"))||[];if(t.push(e),t.length>=5){await I(!0);return}t.forEach(n=>{x.value[n].status="1"}),localStorage.setItem("indices",JSON.stringify(t))},ce=async()=>{if(!c.status||!c.enccode)return;const e=x.value.findIndex(o=>o.enccode===c.enccode);x.value[e].status=c.status,x.value[e]=c,localStorage.removeItem("patientStore"),de(e)};Te(async()=>{le(),await I(),await ce(),X()});function X(){const e=window.matchMedia("(max-width: 767px)"),o=window.matchMedia("(min-width: 768px) and (max-width: 1023px)"),t=window.matchMedia("(min-width: 1024px)");let n,s,u,v;e.matches?(n=50,s=n+50,u=s+50,v=u+50):o.matches?(n=150,s=n+50,u=n+50,v=u+50):t.matches&&(n=200,s=n+50,u=s+50,v=u+50),setTimeout(()=>{l.value=!0},n),setTimeout(()=>{A.value=!0},s),setTimeout(()=>{M.value=!0},u),setTimeout(()=>{L.value=!0},v)}const ue=Ie({waitingSeverity:"info",waitingSummary:"Please wait...",waitingMessage:"Retrieving Archived Injury Cases list..."},{successSeverity:"success",successSummary:"Success!",successMessage:"Archived Injury Cases List loaded successfully",successLife:3e3},{errorSeverity:"error",errorSummary:"Error",errorMessage:"Server Error!"},{asyncFunction:async(e,o)=>await me(e,o,E(g.value),E(y.value)),asyncFunctionParams:[h,"2"]});async function me(e,o){return await Q.injuryListDev(e,o,E(g.value),E(y.value),"admdate")}const I=async e=>{S.value=!0,r.value=[],e&&localStorage.removeItem("indices"),D.removeAllGroups();let o=null;R.value="",c.resets(),N.value=[];try{if(o=await ue.fetchData(),o){if(o.status===401){S.value=!1,localStorage.removeItem("authToken"),await G.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),D.add({severity:"danger",summary:"Session Expired",detail:"Session expired please login again",life:10,closable:!1}),a.push("/auth/login").then(()=>{window.location.reload()});return}N.value=o.data||[]}else D.add({severity:"error",summary:"Error",detail:"No response received from the server.",life:3e3})}catch(t){console.error("Error fetching archived data:",t),D.add({severity:"error",summary:"Error",detail:"Failed to load archived data.",life:3e3})}finally{S.value=!1}};function Z(){const e=window.matchMedia("(max-width: 767px)"),o=window.matchMedia("(min-width: 768px) and (max-width: 1023px)"),t=window.matchMedia("(min-width: 1024px)");let n,s,u,v;e.matches?(n=50,s=n+50,u=s+50,v=u+50):o.matches?(n=150,s=n+50,u=n+50,v=u+50):t.matches&&(s=200,u=s+50,n=s+50,v=s+50),setTimeout(()=>{l.value=!0},n),setTimeout(()=>{B.value=!0},s),setTimeout(()=>{W.value=!0},u),setTimeout(()=>{J.value=!0},v)}const he=async e=>{S.value=!0,c.enccode||await c.loadPatientData(e.data.enccode),V.value=c.details,H.value=!0,U.value=!0,k.value=!0,S.value=!1,Z()},fe=()=>{if(m.value=!1,r.value.length===0){G.fire({icon:"warning",title:"No Patients Selected",text:"Please select at least one patient to export."});return}const e=r.value.map(t=>({name:`${t.header.patlast}, ${t.header.patfirst} ${t.header.patmiddle}`,hospitalNo:t.header.hpercode}));let o="Selected Patients:<br>";e.forEach(t=>{o+=`name: ${t.name.toLowerCase()}, hospital no: ${t.hospitalNo}<br>`}),G.fire({title:"Confirm Export",html:`<div style="font-size: 12px;">${o}</div>`,icon:"info",showCancelButton:!0,confirmButtonText:"Export",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&(Y(),I())})},pe=e=>{const o=new Date(e.header.injtme);return(new Date(e.header.admdate)-o)/(1e3*60*60)>24?"Warning":"Normal"},ve=e=>[{"bg-green-100":e.status==="1"},{"bg-pink-100":e.status==="I"}],we=e=>{if(e.quantity===0)return{fontWeight:"bold",fontStyle:"italic"}},ge=e=>{r.value=e.value,K.value=e.value.map(o=>o.enccode)},ye=e=>{const o=new Date(e.header.injtme);return(new Date(e.header.admdate)-o)/(1e3*60*60)>24};function De(e){try{if(e.type=="checkbox"){K.value.push(e.data.enccode);return}}catch{console.log("bleh :P")}}ee(g,e=>{g.value=e}),ee(y,e=>{y.value=e});function xe(){I()}return{confirmPatientExport:fe,isExportDisabled:ne,filterEdit:ie,conditionStatus:pe,rowStyle:we,rowClass:ve,forArchived:N,openPatientDetails:he,transitionsss:X,onSelectionChange:ge,selectedPatients:r,loadList:I,isConditionWarning:ye,showPatientDialogExport:k,rowSelectForExport:De,patientStore:c,showGeneralData:l,showGeneralDataNOIArchived:A,showExternalCausesArchived:L,showGeneralDataNOI:B,transitions:Z,preAdmissionDataNew:W,externalCauses:J,exporteditOneiss:Y,showPreAdmissionData:U,showExternalCauses:H,exporting:S,fromDate:g,Refresh:xe,toDate:y,isRefreshDisabled:re}}},qe={key:0,class:"loading-overlay"},ze={class:"p-input-icon-left mb-2"},We={key:0,class:"pi pi-exclamation-circle",style:{color:"red",animation:"zoom 0.5s infinite alternate","font-size":"20px"}},Je={class:"font-bold"},Ue={class:"grid col gap-4 flex justify-content-center flex-wrap card-container"},He={class:"generaldata"},Ke={class:"generaldatanoi"},Qe={class:"preadmissiondata"},Ye={class:"externalcauses"};function Xe(m,r,N,a,g,y){const c=f("ProgressSpinner"),F=f("InputText"),D=f("Calendar"),T=f("Button"),h=f("Column"),R=f("DataTable"),V=f("GeneralData"),A=f("GeneralDataNOI"),M=f("PreAdmissionDataNew"),L=f("ExternalCauses"),k=f("Dialog"),x=Ne("tooltip");return _(),q(Ae,null,[a.exporting?(_(),q("div",qe,[d(c,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):P("",!0),p("div",null,[p("span",ze,[r[7]||(r[7]=p("i",{class:"pi pi-search"},null,-1)),d(F,{modelValue:a.filterEdit.global.value,"onUpdate:modelValue":r[0]||(r[0]=l=>a.filterEdit.global.value=l),placeholder:"( Name / Hospital# / DOI / NOI)",class:"w-18rem shadow-2",style:{width:"40%"}},null,8,["modelValue"])]),d(D,{modelValue:a.fromDate,"onUpdate:modelValue":r[1]||(r[1]=l=>a.fromDate=l),placeholder:"From Date",showIcon:!0,class:"w-auto my-auto shadow-4 mx-2",showButtonBar:!0,todayButton:!0},null,8,["modelValue"]),d(D,{modelValue:a.toDate,"onUpdate:modelValue":r[2]||(r[2]=l=>a.toDate=l),placeholder:"To Date",showIcon:!0,class:"w-auto my-auto shadow-4",showButtonBar:!0,todayButton:!0},null,8,["modelValue"]),te(d(T,{disabled:!a.isRefreshDisabled,icon:"pi pi-refresh",size:"large",class:"w-auto mt-2 mr-8 ml-2 shadow-4 mb-1",onClick:r[3]||(r[3]=l=>a.Refresh())},null,8,["disabled"]),[[x,"Refresh List",void 0,{top:!0}]]),te(d(T,{label:"Export Selected Patient/s",icon:"pi pi-file-excel",disabled:a.isExportDisabled,class:"col-12 shadow-4 mb-1",onClick:a.confirmPatientExport},null,8,["disabled","onClick"]),[[x,"Export to Excel",void 0,{top:!0}]])]),d(R,{value:a.forArchived,scrollHeight:"calc(100vh - <height_of_other_elements>)",paginator:!0,rows:10,filters:a.filterEdit,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",selection:a.selectedPatients,"onUpdate:selection":r[4]||(r[4]=l=>a.selectedPatients=l),selectionMode:"multiple",dataKey:"enccode",metaKeySelection:!1,onRowSelect:a.rowSelectForExport,onSelectionChange:a.onSelectionChange,responsiveLayout:"scroll",sortField:"header.injtme",sortOrder:-1,class:"p-datatable-sm shadow-2",style:{"min-height":"100%"},globalFilterFields:["header.patname","header.hpercode","header.status","header.injtme","header.injrem"],stripedRows:"",loading:!a.forArchived,rowClass:a.rowClass,rowStyle:a.rowStyle,virtualScrollerOptions:{itemSize:43}},{default:w(()=>[d(h,{selectionMode:"multiple",headerStyle:"width: 3rem"}),d(h,{sortable:!0,sortField:a.conditionStatus,style:{width:"1.5%"}},{body:w(l=>[p("span",null,[a.isConditionWarning(l.data)?(_(),q("i",We)):P("",!0)])]),_:1},8,["sortField"]),d(h,{field:"header.hpercode",header:"Hospital No.",sortable:!0}),d(h,{header:"Patient Name",sortable:!0},{body:w(l=>[p("span",Je,ae(l.data.header.patlast),1),p("span",null,", "+ae(l.data.header.patfirst+" "+l.data.header.patmiddle),1)]),_:1}),d(h,{field:"header.patsex",header:"Sex"}),d(h,{field:"header.patage",header:"Age",sortable:!0}),d(h,{field:"header.injrem",header:"Nature of Incident",sortable:!0}),d(h,{field:"header.injtme",header:"Date/Time of Incident",sortable:!0}),d(h,{headerStyle:"width: 5rem; text-align: center",header:"View",bodyStyle:"text-align: center; overflow: visible"},{body:w(l=>[d(T,{type:"button",icon:"pi pi-eye",onClick:B=>a.openPatientDetails(l)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","selection","onRowSelect","onSelectionChange","loading","rowClass","rowStyle"]),d(k,{header:"Patient Injury Form",visible:a.showPatientDialogExport,"onUpdate:visible":r[5]||(r[5]=l=>a.showPatientDialogExport=l),maximizable:"",modal:"",onHide:r[6]||(r[6]=l=>a.patientStore.$reset()),style:{width:"120rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:w(()=>[p("div",Ue,[p("div",He,[d(O,{name:"slide-fade",mode:"out-in"},{default:w(()=>[a.showGeneralData?(_(),j(V,{key:0})):P("",!0)]),_:1})]),p("div",Ke,[d(O,{name:"slide-fade",mode:"out-in"},{default:w(()=>[a.showGeneralDataNOI?(_(),j(A,{key:0})):P("",!0)]),_:1})]),p("div",Qe,[d(O,{name:"slide-fade",mode:"out-in"},{default:w(()=>[a.showPreAdmissionData?(_(),j(M,{key:0})):P("",!0)]),_:1})]),p("div",Ye,[d(O,{name:"slide-fade",mode:"out-in"},{default:w(()=>[a.showExternalCauses?(_(),j(L,{key:0})):P("",!0)]),_:1})])])]),_:1},8,["visible"])],64)}const et=Se(Ge,[["render",Xe]]);export{et as default};
