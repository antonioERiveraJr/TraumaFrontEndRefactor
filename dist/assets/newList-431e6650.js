import{A as Be,r as s,u as fe,q as Ce,p as Ne,h as x,B as Oe,E as Ue,o as ge,G as Z,S as A,C as q,c as C,w as g,d as F,e as he,f as E,g as M,j as n,k as N,i as c,U as w,s as ee,z as D,V as $,W as de,m as te,X as ve,Y as $e,Z as ze,I as We,H as Re,_ as qe,n as me,l as pe,F as Ke,b as Je}from"./index-30c64b4f.js";const Ge={class:"bg"},He={key:0},Qe={key:1,class:"col-12 xl:col-12"},Xe={class:"card shadow-4 mx-5 opacity-90",style:{height:"700px"}},Ze={class:"flex align-items-center mb-2 justify-content-between"},et={class:"flex align-items-center"},tt={class:"p-input-icon-left"},at={key:0},st={key:0},ot={key:0},nt={__name:"newInjuryList",props:{savedStartDate:{type:String,required:!0},savedEndDate:{type:String,required:!0},value:{type:String,required:!0}},setup(ae){const p=ae,b=Be(),V=s(null),_=s([]),O=s([]),z=s(!0),S=s(null),v=s(null),K=s(!1),l=fe(),J=s(!1),h=s(!1),d=s(!1),U=s(!1),L=new We,u=s(null),Y=s([]),m=Ce(),se=Ne(),G=s(x(new Date(p.savedStartDate)).format("MM/DD/YYYY")),H=s(x(new Date(p.savedEndDate)).format("MM/DD/YYYY")),k=s(!1),ye=s(null),y=s(0),Q=s(null),oe=s([]),X=s({}),we=s(null),I=s([]),W=s(null),T=s(!0),Se=t=>{k.value=t},xe=Oe(b,l.details);Ue("v$",xe);const De=async t=>{const e=u.value[t];e.status=l.status;const r=JSON.parse(localStorage.getItem("indices"))||[];if(r.push(t),r.length>=5){await B(!0);return}r.forEach(o=>{u.value[o].status="1"}),localStorage.setItem("indices",JSON.stringify(r))},_e=async()=>{if(!l.status||!l.enccode)return;const t=u.value.findIndex(e=>e.enccode===l.enccode);u.value[t].status=l.status,u.value[t]=l,localStorage.removeItem("patientStore"),De(t)},Ie=()=>{if(localStorage.getItem("patientStore")){const t=JSON.parse(localStorage.getItem("enccode")),e=JSON.parse(localStorage.getItem("status")),r=JSON.parse(localStorage.getItem("header")),o=JSON.parse(localStorage.getItem("data"));l.enccode=t,l.status=e,l.header={...r},l.details={...o},l.loadPatientData()}};ge(async()=>{l.registry="new",Ie(),await B(),await _e(),je()});async function Ee(t,e){const r=await L.injuryList(t,e,G.value,H.value,p.value);return T.value=!1,r}const R=async(t,e)=>(T.value=!0,await Ee(t,e,G.value,H.value,p.value)),Me=t=>{y.value!==t.index&&(y.value=t.index,O.value=null,Y.value=null,S.value=null,B(!0))},be=s({global:{value:null,matchMode:Z.CONTAINS},status:{value:null,matchMode:Z.IN},date:{value:null,matchMode:Z.EQUALS}}),B=async t=>{_.value=[],t&&localStorage.removeItem("indices"),se.removeAllGroups();var e=null;if(y.value==0){if(l.resets(),u.value=null,e=await ne.fetchData(),e&&e.status===401){console.log("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}u.value=e.data}if(y.value==1){if(u.value=null,e=await Te.fetchData(),e&&e.status===401){console.warn("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}u.value=e.data}if(y.value==2){if(Y.value="",l.resets(),I.value=null,e=await re.fetchData(),e&&e.status===401){console.warn("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}I.value=e.data}if(y.value==3){if(Y.value="",l.resets(),I.value=null,e=await re.fetchData(),e&&e.status===401){console.warn("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}I.value=e==null?void 0:e.data}if(y.value==4){Y.value="",l.resets(),v.value=null;const r=await Le.fetchData();v.value=r.data;const o=v.value.map(a=>a.exportby).filter(Boolean);if(await L.fetchEmployeeNames(o),v.value)if(we.value=Object.groupBy(v.value,Ve,Ye),o.length>0)try{const a=await L.fetchEmployeeNames(o);for(let i=0;i<v.value.length;i++){const f=a[i];f?v.value[i].header.exportby=`${f.firstname} ${f.lastname}`:v.value[i].header.exportby="Unknown"}}catch(a){console.error("Failed to fetch employee names:",a);for(const i of v.value)i.header.exportby="Unknown"}else console.log("No employee IDs available for fetching names.");else console.log("No archived data available.")}if(y.value==5){if(l.resets(),u.value=null,e=await ne.fetchData(),e&&e.status===401){console.warn("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}u.value=e.data}else if(e&&e.status===401){console.warn("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}},ne=q({waitingSeverity:"info",waitingSummary:"Please wait...",waitingMessage:"Retrieving Injury Cases list..."},{successSeverity:"success",successSummary:"Sucess!",successMessage:"Injury Cases List loaded successfully",successLife:3e3},{errorSeverity:"error",errorSummary:"Error",errorMessage:"Server Error!"},{asyncFunction:R,asyncFunctionParams:[W,null]}),Le=q({waitingSeverity:"info",waitingSummary:"Please wait...",waitingMessage:"Retrieving Archived Injury Cases list..."},{successSeverity:"success",successSummary:"Sucess!",successMessage:"Archived Injury Cases List loaded successfully",successLife:3e3},{errorSeverity:"error",errorSummary:"Error",errorMessage:"Server Error!"},{asyncFunction:R,asyncFunctionParams:[W,"2"]}),re=q({waitingSeverity:"info",waitingSummary:"Please wait...",waitingMessage:"Retrieving For Export list..."},{successSeverity:"success",successSummary:"Sucess!",successMessage:"For Export List loaded successfully",successLife:3e3},{errorSeverity:"error",errorSummary:"Error",errorMessage:"Server Error!"},{asyncFunction:R,asyncFunctionParams:[W,"1"]}),Te=q({waitingSeverity:"info",waitingSummary:"Please wait...",waitingMessage:"Retrieving Injury Cases list..."},{successSeverity:"success",successSummary:"Sucess!",successMessage:"Injury Cases List loaded successfully",successLife:3e3},{errorSeverity:"error",errorSummary:"Error",errorMessage:"Server Error!"},{asyncFunction:R,asyncFunctionParams:[W,null]}),Pe=C(()=>u.value?u.value.filter(t=>t.header.dispcode!=="ADMIT"):[]);function je(){const t=window.matchMedia("(max-width: 767px)"),e=window.matchMedia("(min-width: 768px) and (max-width: 1023px)"),r=window.matchMedia("(min-width: 1024px)");let o,a,i,f;t.matches?(o=50,a=o+50,i=a+50,f=i+50):e.matches?(o=150,a=o+50,i=o+50,f=i+50):r.matches&&(a=200,i=a+50,o=a+50,f=a+50),setTimeout(()=>{J.value=!0},o),setTimeout(()=>{h.value=!0},a),setTimeout(()=>{d.value=!0},i),setTimeout(()=>{U.value=!0},f)}const Ae=C(()=>u.value?u.value.filter(t=>t.header.dispcode==="ADMIT"):[]),Fe=C(()=>I.value?I.value.filter(t=>t.header.dispcode==="ADMIT"):[]);function Ve({header:t}){return t.exportby}function Ye({header:t}){return t.patname}const le=async()=>{k.value=!0;const t=Re().value;try{const e=[],r=[];for(const a of _.value)a.status="2",a.header.status="2",r.push(a.enccode),e.push({enccode:a.enccode,patname:a.header.patlast+", "+a.header.patfirst+" "+a.header.patmiddle,patsex:a.header.patsex,patage:a.header.patage,injrem:a.header.injrem,injtme:a.header.injtime,injloc:a.header.injloc});const o=await L.archDate(r,t);if(o&&o.status===401){console.log("401 Unauthorized"),localStorage.removeItem("authToken"),await A.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}await l.saveFormattedDataArchived(r,t),await L.sendArrayToServer(e,t)}catch(e){console.error("Error exporting data to Excel:",e),se.add({severity:"error",summary:"Export Error",detail:"Failed to export data to Excel",life:3e3})}finally{k.value=!1,B()}},ie=C(()=>_.value.length===0),ke=C(()=>I.value?I.value.filter(t=>t.header.dispcode!=="ADMIT"):[]),ue=t=>{_.value=t},ce=C(()=>Object.entries(X.value).map(([t,e])=>{const r=t.replace("Injury","").trim(),o=new Date(r),a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},i=o.toLocaleString("en-US",a).replace(",",""),f=e.map(j=>j.header.patname).filter(j=>j),P=e.map(j=>j.header.hpercode).filter(j=>j);return{archdate:i,items:e,count:e.length,names:f,exportByIDs:P}}));return g(()=>_.value,t=>{O.value=t.map(e=>e.enccode)}),g(()=>p.value,t=>{V.value=t}),g(()=>K.value,t=>{t||(v.value=ye.value)}),g(()=>l.loadSignal,t=>{t&&B()}),g(Q,t=>{if(t){const e=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t);be.value.global.value=e}}),g(v,t=>{if(t){const e=t.reduce((o,a)=>(o.push(a),o),[]);oe.value=e;const r=e.reduce((o,a)=>{const i=a.archdate;return o[i]||(o[i]=[]),o[i].push(a),o},{});X.value=r}else oe.value=[],X.value={}},{immediate:!0}),g(()=>p.savedStartDate,t=>{G.value=x(new Date(t)).format("MM/DD/YYYY")}),g(()=>p.savedEndDate,t=>{H.value=x(new Date(t)).format("MM/DD/YYYY")}),l.details.loader!=null&&(B(!0),l.value.details.loader=""),(t,e)=>{const r=F("ProgressSpinner"),o=F("InputText"),a=F("Button"),i=F("Toast"),f=he("tooltip");return E(),M("div",Ge,[k.value?(E(),M("div",He,[n(r,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0),z.value?(E(),M("div",Qe,[c("div",Xe,[c("div",Ze,[c("div",et,[c("span",tt,[e[4]||(e[4]=c("i",{class:"pi pi-search"},null,-1)),n(o,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=P=>S.value=P),placeholder:"( Name / Hospital# / DOI / NOI)",class:"w-18rem shadow-2",style:{width:"40%"}},null,8,["modelValue"])]),n(w(ee),{modelValue:Q.value,"onUpdate:modelValue":e[1]||(e[1]=P=>Q.value=P),showIcon:!0,class:"calendar-icon-only"},null,8,["modelValue"])])]),n(w(ze),{lazy:!1,onTabChange:Me},{default:D(()=>[n(w($),{header:"Injury Cases"},{header:D(()=>[!u.value&&y.value==="0"?(E(),M("div",at,[n(r,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0)]),default:D(()=>[n(de,{filterValue:S.value,list:Pe.value,loading:T.value,newList:!0},null,8,["filterValue","list","loading"])]),_:1}),n(w($),{header:"Admitted  Cases"},{header:D(()=>[!u.value&&y.value==="1"?(E(),M("div",st,[n(r,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0)]),default:D(()=>[n(de,{filterValue:S.value,list:Ae.value,loading:T.value},null,8,["filterValue","list","loading"])]),_:1}),n(w($),{header:"Export Admitted Cases"},{default:D(()=>[te(n(a,{label:"Export",icon:"pi pi-file-excel",disabled:ie.value,class:"col-12 shadow-4 mb-3",onClick:e[2]||(e[2]=P=>le()),loading:k.value},null,8,["disabled","loading"]),[[f,"Export to Excel",void 0,{top:!0}]]),n(ve,{filterValue:S.value,list:Fe.value,"onUpdate:selectedPatients":ue,loading:T.value},null,8,["filterValue","list","loading"])]),_:1}),n(w($),{header:"For Export"},{default:D(()=>[te(n(a,{label:"Export",icon:"pi pi-file-excel",disabled:ie.value,class:"col-12 shadow-4 mb-3",onClick:e[3]||(e[3]=P=>le()),loading:k.value},null,8,["disabled","loading"]),[[f,"Export to Excel",void 0,{top:!0}]]),n(ve,{filterValue:S.value,list:ke.value,"onUpdate:selectedPatients":ue,loading:T.value},null,8,["filterValue","list","loading"])]),_:1}),n(w($),{header:"Archived"},{header:D(()=>[!ce.value&&y.value=="4"?(E(),M("div",ot,[n(r,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0)]),default:D(()=>[n($e,{filterValue:S.value,list:ce.value,loading:T.value,"onUpdate:exporting":Se},null,8,["filterValue","list","loading"])]),_:1})]),_:1})]),n(i)])):N("",!0)])}}};const rt={key:0},lt={class:"flex justify-content-center"},it={class:"flex",style:{"max-width":"100%",position:"relative","margin-left":"1%"}},ut={class:"calendar-container mb-2 ml-4"},ct={class:"calendar-container ml-4"},dt={class:"flex justify-content-center"},vt={__name:"newList",setup(ae){const p=s(x().subtract(7,"days").toDate()),b=s(x().toDate()),V=fe(),_=s(null),O=s(null),z=s(null),S=s(!1),v=s("Date of Injury"),K=s(["Date of Injury","Date of Consultation"]),l=s(null),J=s(null);return g(v,h=>{v.value=h}),g(O,h=>{O.value=x(h).format("MM/DD/YYYY")}),g(z,h=>{z.value=x(h).format("MM/DD/YYYY")}),g(b,h=>{if(!p.value){_.value.add({severity:"warn",summary:"Warning",detail:"Please select a start date first.",life:3e3}),b.value=null;return}const d=x(h).format("MM/DD/YYYY"),U=x(p.value).format("MM/DD/YYYY");J.value=d,l.value=U}),ge(async()=>{V.registry="new"}),g(()=>V.registry,h=>{h!=="new"&&(V.registry="new")}),(h,d)=>{const U=F("ProgressSpinner"),L=F("SelectButton"),u=F("Button"),Y=he("tooltip");return E(),M(Ke,null,[c("div",null,[S.value?(E(),M("div",rt,[n(U,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0),c("div",lt,[n(L,{modelValue:v.value,"onUpdate:modelValue":d[0]||(d[0]=m=>v.value=m),options:K.value},null,8,["modelValue","options"]),c("div",it,[c("div",ut,[d[4]||(d[4]=c("strong",{class:"label-from ml-4 mb-1"},"FROM",-1)),n(w(ee),{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=m=>p.value=m),dateFormat:"mm/dd/yy",style:me([{"max-width":"100%",height:"30px"},{height:"30px"}]),showIcon:!0,class:"w-auto my-auto shadow-4",showButtonBar:!0,todayButton:!0},null,8,["modelValue"])]),c("div",ct,[d[5]||(d[5]=c("strong",{class:"label-to ml-4"},"TO",-1)),n(w(ee),{modelValue:b.value,"onUpdate:modelValue":d[2]||(d[2]=m=>b.value=m),dateFormat:"mm/dd/yy",style:me([{"max-width":"100%",height:"30px"},{height:"30px"}]),showIcon:!0,class:"w-auto my-auto shadow-4",showButtonBar:!0,todayButton:!0},null,8,["modelValue"])])]),d[6]||(d[6]=c("span",{class:"tooltip",style:{cursor:"pointer","margin-left":"0.5%","margin-right":"1%"}},[c("i",{class:"pi pi-question-circle",style:{"font-size":"1.5em"}}),c("span",{class:"tooltiptext"},[pe("Please note that you can only select dates within 30 days prior to today. "),c("br"),c("br"),pe(" If you need to access dates beyond this range, kindly reach out to the MIS department for assistance.")])],-1)),c("div",null,[te(n(u,{icon:"pi pi-refresh",size:"small",class:"w-auto mr-8 ml-2 shadow-4",onClick:d[3]||(d[3]=m=>w(V).loadSignal=!0)},null,512),[[Y,"Refresh List",void 0,{top:!0}]])])])]),c("div",dt,[n(nt,{class:"w-12 opacity-90",style:{"max-height":"400px"},savedStartDate:p.value.toString(),savedEndDate:b.value.toString(),value:v.value},null,8,["savedStartDate","savedEndDate","value"])]),n(w(Je),{ref_key:"toast",ref:_},null,512)],64)}}},pt=qe(vt,[["__scopeId","data-v-6c3dc748"]]);export{pt as default};
