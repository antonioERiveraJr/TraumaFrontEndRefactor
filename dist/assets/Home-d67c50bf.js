import{_ as N,p as Z,r as f,q as $,t as J,c as w,o as K,w as Q,f as E,g as P,i as l,l as k,v as S,x as L,k as X,F as ee,S as te,y as ae,I as re,s as U,d as D,j as p,z as W}from"./index-30c64b4f.js";import{C as _,r as ne}from"./chart.esm-a5e4ede4.js";_.register(...ne);const oe={props:{fromDate:{type:Date,required:!0},toDate:{type:Date,required:!0}},setup(u){const r=Z(),b=new re,n=f([]),g=f(!1),j=f(),m=$();let h=!0;const x=new AbortController;let O=null,c=null,v=null,y=null;const H=f(["Bite","Burn","Chemical Substance","Contact with Sharp Objects","Drowning","Exposure to Forces of Nature","Fall","Firecracker","Vapor","Gunshot","Hanging","Mauling","Sexual","Others","Include"]),B=async()=>{g.value=!0;try{const t=await b.reportList(!0,u.fromDate.toLocaleDateString("en-US"),u.toDate.toLocaleDateString("en-US"),null,{signal:x.signal});if(t&&t.status===200)n.value=t.data;else throw new Error("Failed to fetch report data");if(t&&t.status===401){g.value=!1,console.log("401 Unauthorized"),localStorage.removeItem("authToken"),await te.fire({icon:"warning",title:"Session Expired",text:"Please Login Again",confirmButtonText:"OK"}),m.push("/auth/login").then(()=>{window.location.reload()});return}await ae(),V(I.value),M(F.value),q(),z()}catch{r.value&&r.value.add({severity:"error",summary:"Error",detail:"Could not fetch report data.",life:3e3})}finally{g.value=!1}};J(()=>{h=!1,x.abort()});const G=w(()=>T.value.length),R=f(0),T=w(()=>n.value.map(t=>{var i;const o=(i=t.header.injrem)==null?void 0:i.trim().toLowerCase(),a={bite:["bite","sting"],burn:["burn","burns"],"chemical substance":["chemical substance","chem","chemical"],"contact with sharp objects":["contact with sharp objects","sharp"],drowning:["drowning","drown"],"exposure to forces of nature":["exposure to forces of nature","nature"],fall:["fall","falls"],firecracker:["firecracker","fire"],vapor:["vapor","htd product"],gunshot:["gunshot","shot","gun"],hanging:["hanging","strangulation","hang"],mauling:["mauling","assault","maul","maulin","mamuling"],sexual:["s.a.","sexual","sa"],others:["other","others"],include:["domestic","abuse","fwri","pa","va","laceration","trauma","bicycle","foreign","bike","alleged","motor","medicolegal","mva","mvc","injury","scratch","punctured","wound","needle","sharp","prick","electrocution","accident","lacerated","motorcycle"]},d=Object.entries(a).some(([e,C])=>C.some(s=>o&&o.includes(s)));return o&&a.include.some(e=>o.includes(e))&&R.value++,d?t:{...t,header:{...t.header,injrem:"Others"}}})),q=()=>{const t=document.getElementById("preAdmissionPieChart").getContext("2d"),o=I.value,a=Object.keys(o),d=Object.values(o);v=new _(t,{type:"pie",data:{labels:a,datasets:[{label:"Pre-Admission Injury Counts",data:d,backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(255, 206, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 159, 64, 0.8)","rgba(201, 203, 207, 0.8)","rgba(255, 99, 71, 0.8)","rgba(0, 255, 127, 0.8)","rgba(255, 0, 0, 0.8)","rgba(255, 20, 147, 0.8)","rgba(128, 0, 128, 0.8)","rgba(255, 140, 0, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)","rgba(255, 99, 71, 1)","rgba(0, 255, 127, 1)","rgba(255, 0, 0, 0.8)","rgba(255, 20, 147, 1)","rgba(128, 0, 128, 1)","rgba(255, 140, 0, 1)"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},title:{display:!0,text:"Pre-Admission Injury Pie Chart"}}}})},z=()=>{const t=document.getElementById("externalCausePieChart").getContext("2d"),o=F.value,a=Object.keys(o),d=Object.values(o);y=new _(t,{type:"pie",data:{labels:a,datasets:[{label:"External Cause Counts",data:d,backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(255, 206, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 159, 64, 0.8)","rgba(201, 203, 207, 0.8)","rgba(255, 99, 71, 0.8)","rgba(0, 255, 127, 0.8)","rgba(255, 0, 0, 0.8)","rgba(255, 20, 147, 0.8)","rgba(128, 0, 128, 0.8)","rgba(255, 140, 0, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)","rgba(255, 99, 71, 1)","rgba(0, 255, 127, 1)","rgba(255, 0, 0, 0.8)","rgba(255, 20, 147, 1)","rgba(128, 0, 128, 1)","rgba(255, 140, 0, 1)"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},title:{display:!0,text:"External Cause of Injury Pie Chart"}}}})},I=w(()=>{const t={abrasion:0,burns:0,avulsion:0,concussion:0,contusion:0,fractureOpen:0,fractureClosed:0,openWound:0,amputation:0,others:0};return n.value.forEach(o=>{const a=o.details&&o.details.natureOfInjury;a&&(a.noi_abrasion==="Y"&&t.abrasion++,a.noi_burn_r==="Y"&&t.burns++,a.noi_avulsion==="Y"&&t.avulsion++,a.noi_concussion==="Y"&&t.concussion++,a.noi_contusion==="Y"&&t.contusion++,a.noi_frac_ope==="Y"&&t.fractureOpen++,a.noi_frac_clo==="Y"&&t.fractureClosed++,a.noi_owound==="Y"&&t.openWound++,a.noi_amp==="Y"&&t.amputation++,a.noi_others==="Y"&&t.others++)}),t});let Y=null;const V=t=>{const o=document.getElementById("preAdmissionChart").getContext("2d");Y&&Y.destroy();const a=["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)"];Y=new _(o,{type:"bar",data:{labels:Object.keys(t),datasets:[{label:"Count of Pre-Admission Injury (Female)",data:Object.values(t).map((d,i)=>{let e=Object.keys(t)[i];return e==="burns"?e="burn_r":e==="fractureOpen"?e="frac_ope":e==="fractureClosed"?e="frac_clo":e==="openWound"?e="owound":e==="amputation"&&(e="amp"),n.value.filter(s=>s.header.patsex==="F"&&s.details&&s.details.natureOfInjury[`noi_${e}`]==="Y").length}),backgroundColor:a[0],borderColor:a[0].replace("0.5","1"),borderWidth:1},{label:"Count of Pre-Admission Injury (Male)",data:Object.values(t).map((d,i)=>{let e=Object.keys(t)[i];return e==="burns"?e="burn_r":e==="fractureOpen"?e="frac_ope":e==="fractureClosed"?e="frac_clo":e==="openWound"?e="owound":e==="amputation"&&(e="amp"),n.value.filter(s=>s.header.patsex==="M"&&s.details&&s.details.natureOfInjury[`noi_${e}`]==="Y").length}),backgroundColor:a[1],borderColor:a[0].replace("0.5","1"),borderWidth:1}]},options:{scales:{x:{stacked:!0},y:{beginAtZero:!0,stacked:!0}}}})};let A;const M=t=>{const o=document.getElementById("externalCauseChart").getContext("2d");A&&A.destroy();const a=["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)"];A=new _(o,{type:"bar",data:{labels:Object.keys(t),datasets:[{label:"Count of External Causes of Injury (Female) ",data:Object.values(t).map((d,i)=>{let e=Object.keys(t)[i];return e==="bites"?e="bite":e==="burns"?e="burn_r":e==="chemicals"?e="chem":e==="sharpObjects"?e="sharp":e==="drownings"?e="drown_r":e==="exposures"?e="expo_nature_r":e==="firecrackers"?e="firecracker_r":e==="gunshot"?e="gun":e==="hanging"?e="hang":e==="mauling"?e="maul":e==="transportAccidents"?e="transport":e==="sexualAssaults"?e="sexual":e==="others"&&(e="other"),n.value.filter(s=>s.header.patsex==="F"&&s.details&&s.details.ExternalCauseOfInjury[`ext_${e}`]==="Y").length}),backgroundColor:a[0],borderColor:a[0].replace("0.5","1"),borderWidth:1},{label:"Count of External Causes of Injury (Male)",data:Object.values(t).map((d,i)=>{let e=Object.keys(t)[i];return e==="bites"?e="bite":e==="burns"?e="burn_r":e==="chemicals"?e="chem":e==="sharpObjects"?e="sharp":e==="drownings"?e="drown_r":e==="exposures"?e="expo_nature_r":e==="firecrackers"?e="firecracker_r":e==="gunshot"?e="gun":e==="hanging"?e="hang":e==="mauling"?e="maul":e==="transportAccidents"?e="transport":e==="sexualAssaults"?e="sexual":e==="others"&&(e="other"),n.value.filter(s=>s.header.patsex==="M"&&s.details&&s.details.ExternalCauseOfInjury[`ext_${e}`]==="Y").length}),backgroundColor:a[1],borderColor:a[0].replace("0.5","1"),borderWidth:1}]},options:{scales:{x:{stacked:!0},y:{beginAtZero:!0,stacked:!0}}}})},F=w(()=>{const t={bites:0,burns:0,chemicals:0,sharpObjects:0,drownings:0,exposures:0,fall:0,firecrackers:0,vape:0,gunshot:0,hanging:0,mauling:0,transportAccidents:0,sexualAssaults:0,others:0};return n.value.forEach(o=>{const a=o.details&&o.details.ExternalCauseOfInjury;a&&(a.ext_bite==="Y"&&t.bites++,a.ext_burn_r==="Y"&&t.burns++,a.ext_chem==="Y"&&t.chemicals++,a.ext_sharp==="Y"&&t.sharpObjects++,a.ext_drown_r==="Y"&&t.drownings++,a.ext_expo_nature_r==="Y"&&t.exposures++,a.ext_fall==="Y"&&t.fall++,a.ext_firecracker_r==="Y"&&t.firecrackers++,a.ext_vape==="Y"&&t.vape++,a.ext_gun==="Y"&&t.gunshot++,a.ext_hang==="Y"&&t.hanging++,a.ext_maul==="Y"&&t.mauling++,a.ext_transport==="Y"&&t.transportAccidents++,a.ext_sexual==="Y"&&t.sexualAssaults++,a.ext_other==="Y"&&t.others++)}),t});return K(async()=>{await B()}),Q(()=>[u.fromDate,u.toDate],t=>{v&&(v.destroy(),v=null),y&&(y.destroy(),y=null),B()}),{selectedNOI:j,listOfNOI:H,loading:g,createChartExport:M,filteredData:T,pieChart:c,externalCausePieChart:y,preAdmissionPieChart:v,externalCauseCounts:F,injuryByPreAdmission:I,barChart:O,createChart:V,isMounted:h,totalInjuries:G}}},se={class:"flex justify-content-center"},le={key:0,class:"spinner",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}};function ie(u,r,b,n,g,j){return E(),P(ee,null,[l("div",se,[l("strong",null,[k(" TOTAL INJURIES: "+S(n.totalInjuries)+" ",1),r[0]||(r[0]=l("span",null,"   ",-1)),k(" FROM: "+S(b.fromDate.toLocaleDateString("en-US"))+" ",1),r[1]||(r[1]=l("span",null,"   ",-1)),k(" TO: "+S(b.toDate.toLocaleDateString("en-US")),1)])]),r[3]||(r[3]=L('<div class="flex grid-cols-2 mt-2 justify-content-center"><div class="bord mr-1" style="height:50%;width:48%;"><canvas id="preAdmissionChart"></canvas></div><div class="bord mr-1" style="height:50%;width:48%;"><canvas id="externalCauseChart"></canvas></div></div>',1)),n.loading?(E(),P("div",le,r[2]||(r[2]=[l("div",{class:"loader"},null,-1)]))):X("",!0),r[4]||(r[4]=L('<div class="flex grid-cols-2 mt-2 justify-content-center"><div class="bord mr-1" style="height:50%;width:48%;"><canvas id="preAdmissionPieChart"></canvas></div><div class="bord mr-1" style="height:50%;width:48%;"><canvas id="externalCausePieChart"></canvas></div></div>',1))],64)}const ue=N(oe,[["render",ie]]);const ce={components:{HomeGraph:ue,Calendar:U},setup(){const u=f("topright"),r=f(!1),b=f(new Date),n=f(new Date(new Date().setDate(new Date().getDate()-7)));return{openPosition:m=>{u.value=m,r.value=!0},visible:r,position:u,fromDate:n,toDate:b,Calendar:U,submitDates:()=>{r.value=!1}}}},de={class:"flex bord mx-3 justify-content-center"},fe={class:"m-3",style:{height:"50%",width:"100%"}},be={class:"flex bord flex-column align-items-start"},ge={class:"flex justify-end gap-2 mt-4"};function pe(u,r,b,n,g,j){const m=D("HomeGraph"),h=D("Calendar"),x=D("Button"),O=D("Dialog");return E(),P("div",null,[l("div",de,[l("div",fe,[p(m,{fromDate:n.fromDate,toDate:n.toDate},null,8,["fromDate","toDate"])]),l("div",{class:"calendar-icon-wrapper",label:"TopRight",onClick:r[0]||(r[0]=c=>n.openPosition("topright"))},r[5]||(r[5]=[l("i",{class:"pi pi-calendar"},null,-1)]))]),p(O,{visible:n.visible,"onUpdate:visible":r[4]||(r[4]=c=>n.visible=c),header:"Choose Date",style:{width:"25rem"},position:n.position,modal:!0,draggable:!1},{default:W(()=>[l("div",be,[r[7]||(r[7]=l("label",{class:"flex justify-content-start",for:"from-calendar"},[l("strong",null,"From:")],-1)),p(h,{modelValue:n.fromDate,"onUpdate:modelValue":r[1]||(r[1]=c=>n.fromDate=c),id:"from-calendar",placeholder:"Select a date"},null,8,["modelValue"]),r[8]||(r[8]=l("label",{class:"flex justify-content-start",for:"to-calendar"},[l("strong",null,"To:")],-1)),p(h,{modelValue:n.toDate,"onUpdate:modelValue":r[2]||(r[2]=c=>n.toDate=c),id:"to-calendar",placeholder:"Select a date"},null,8,["modelValue"]),l("div",ge,[p(x,{type:"button",label:"Cancel",severity:"secondary",onClick:r[3]||(r[3]=c=>n.visible=!1)}),p(x,{type:"button",label:"Submit",onClick:n.submitDates},{default:W(()=>r[6]||(r[6]=[k("Submit")])),_:1},8,["onClick"])])])]),_:1},8,["visible","position"])])}const xe=N(ce,[["render",pe],["__scopeId","data-v-5641dada"]]);export{xe as default};
